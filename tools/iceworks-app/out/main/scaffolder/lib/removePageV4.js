const e=require("fs"),r=require("path"),i=require("babylon"),n=require("babel-generator").default,t=require("babel-traverse").default,o=require("babel-types"),a=require("rimraf"),s=require("prettier"),l=require("../../config");function u(r){const n=e.readFileSync(r).toString();return i.parse(n,{sourceType:"module",plugins:["*"]})}const c="routerConfig",p="asideMenuConfig";function m(e,r){return e.filter(e=>!e.properties.some(e=>"children"===e.key.name&&o.isArrayExpression(e.value)?(e.value.elements=m(e.value.elements,r),!1):"path"===e.key.name&&e.value.value===r))}module.exports=async function({clientSrcPath:i,pageFolderName:f,routerPath:d=""}){const y=`./pages/${f}`,g=r.join(i,"routerConfig.js"),v=r.join(i,`/pages/${f}`);let b="";a.sync(v);const q=u(g);if(t(q,{ImportDeclaration(e){const{node:r}=e;o.isStringLiteral(r.source)&&r.source.value===y&&(r.specifiers.forEach(e=>{o.isImportDefaultSpecifier(e)&&o.isIdentifier(e.local)&&(b=e.local.name)}),e.remove())}}),t(q,{VariableDeclarator({node:e}){o.isIdentifier(e.id,{name:c})&&o.isArrayExpression(e.init)&&(e.init.elements=e.init.elements.filter(e=>{const r=e.properties.some(e=>"component"===e.key.name&&e.value.name===b);return r&&e.properties.forEach(e=>{"path"===e.key.name&&(d=e.value.value)}),!r}))}}),e.writeFileSync(g,s.format(n(q).code,l.prettier)),d){const a=r.join(i,"menuConfig.js"),c=u(a);t(c,{VariableDeclarator(e){o.isIdentifier(e.node.id,{name:p})&&o.isArrayExpression(e.node.init)&&(e.node.init.elements=m(e.node.init.elements,d))}}),e.writeFileSync(a,s.format(n(c).code,l.prettier))}};