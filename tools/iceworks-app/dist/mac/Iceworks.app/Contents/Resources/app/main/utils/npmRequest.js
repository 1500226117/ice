const e=require("request"),r=require("semver"),s=require("../services/settings"),t=require("../logger"),o=require("./autoRetry");function i({name:o,version:i="latest",registry:n}){const a=s.get("registry");let l=n||a||"https://registry.npmjs.com";const u=`${l=l.replace(/\/$/,"")}/${o.replace(/\//g,"%2f")}`;return t.debug("npmRequest",u),new Promise((s,n)=>{e({url:u,json:!0,timeout:5e3},(e,a,c)=>{if(e||!c){const r=e||new Error(JSON.stringify(a.body));r.name="get-tarball-info-error",r.data={url:u},t.error(r),n(r)}else if(r.valid(i)||(i=c["dist-tags"][i]),r.valid(i)&&c&&c.versions&&c.versions[i])s(c.versions[i]);else{const e=new Error(`${o}@${i} \u5c1a\u672a\u53d1\u5e03\u5728 ${l}`);e.name="get-tarball-info-error",t.error(e),n(e)}})})}const n=2;module.exports=o(i,2,e=>e.code&&("ETIMEDOUT"===e.code||"ESOCKETTIMEDOUT"===e.code));