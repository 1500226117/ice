const e=require("uuid"),{EventEmitter:i}=require("events"),s=require("./Session"),t=require("../../spc"),d={},n="session:data",r="session:exit",l="session:newline";class o extends i{new({uid:i=e.v4(),cwd:o,cwdClient:c,shell:u,shellArgs:w,env:a={}},p=(()=>{})){const m=new s({cwd:c||o,shell:u,shellArgs:w,env:a});return d[i]=m,t.emit(n,{uid:i,cwd:o,pid:m.pty.pid,data:`${u} ${w.join(" ")} \n\r`}),m.on("data",e=>{t.emit(n,{uid:i,pid:m.pty.pid,cwd:o,data:e})}),m.on("exit",(e,s)=>{t.emit(r,{uid:i,pid:m.pty.pid,cwd:o,code:e,signal:s}),t.emit(l,{cwd:o}),this.delete(i),p(e,s)}),m}delete(e){delete d[e]}destory(){return new Promise(e=>{Object.keys(d).forEach(e=>{d[e].destroy()}),e()})}}module.exports=new o;