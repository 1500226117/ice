const{ipcMain:e,BrowserWindow:o}=require("electron"),{globalShortcut:r}=require("electron"),t=require("./logger"),s=require("./glodlog"),{isWin:i,isMac:n}=require("./shared"),c=require("./dau"),l=require("./services/sessions");n&&(process.env.PATH=["/usr/local/bin",process.env.PATH].join(":")),exports.registerApp=((r,u)=>{r.on("will-quit",()=>{t.info("will-quit")}).on("window-all-closed",()=>{t.info("window-all-closed"),i?l.manager.destory().then(()=>{r.quit()}).catch(()=>{r.quit()}):l.manager.destory().then(()=>{}).catch(()=>{})}).on("before-quit",()=>{s.record({type:"app",action:"before-quit"}),t.info("before-quit"),n&&o.getAllWindows().forEach(e=>{e.destroy()})}).on("activate",()=>{u.home.show(),u.home.focus()}),e.on("setTitle",(e,o)=>{u.home.setTitle(o)}),u.home.on("focus",({sender:e})=>{c.record(),e.webContents.send("focus")})}),exports.registerShortcut=((e,o)=>{const i="CommandOrControl+alt+P";r.register(i,()=>{o.home.show()})&&(t.info("shortcutKey register success",i),s.record({type:"app",action:"shortcut-key",shortcutKey:i})),e.on("will-quit",()=>{r.unregisterAll()})});