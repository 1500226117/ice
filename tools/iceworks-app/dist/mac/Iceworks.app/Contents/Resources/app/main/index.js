const e=require("./logger"),r=require("./glodlog"),o=require("./helper/checkEnv"),s=require("./network"),i=require("./spc"),n=require("url-parse"),{app:t}=require("electron"),{appMenu:c}=require("./menu"),{registerApp:a,registerShortcut:l}=require("./app"),{createHomeWindow:u,createTouchBar:p}=require("./windowList"),d=require("./ipcService"),{isDev:h}=require("./shared"),{register:g}=require("./autoUpdater"),q=require("./services"),{settings:w}=q;global.services=q;const{default:b,REACT_DEVELOPER_TOOLS:v}=require("electron-devtools-installer"),f=async()=>b(v),m={};global.windows=m,q.createTouchBar=p,process.on("error",r=>{r.name="process-error",e.error(r)}).on("unhandledRejection",(r,o)=>{const s=new Error(`App Unhandled Rejection at:, ${o}, 'reason:', ${r}`);s.name="process-unhandled-rejection",e.error(s)}).on("uncaughtException",r=>{r.name="process-uncaught-exception",e.error(r)}),t.setAsDefaultProtocolClient("iceworks"),t.on("ready",async()=>{h&&await f(),e.info("process.version:",process.version),e.info("process.platform:",process.platform),e.info("process.arch:",process.arch),e.info("process.versions.modules:",process.versions.modules),r.record({type:"app",action:"launch",version:t.getVersion()}),w.init();const n=u(t);if(m.home=n,t.windows=m,global.windows=m,i.bindWindow(n),c(t,m),a(t,m),l(t,m),h||g(t,m),d.init(),o(),w.get("forceNotAlibaba"))w.set("isAlibaba",!1);else{const e=await s.isAlibaba();w.set("isAlibaba",e)}}),t.on("will-finish-launching",()=>{t.on("open-url",(e,r)=>{const o=n(r,!0).query;Object.keys(o).length>0&&w.set("urlEvokeQuery",o)})});